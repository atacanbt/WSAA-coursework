<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-section { margin-bottom: 2rem; }
        .edit-form { display: none; }
        .error { color: red; }
    </style>
</head>
<body class="container mt-4">
    <h1 class="mb-4">Car Management System</h1>

    <!-- Add Car Form -->
    <div class="form-section">
        <h3>Add New Car</h3>
        <form id="addCarForm" class="row g-3">
            <div class="col-md-3">
                <input type="text" class="form-control" placeholder="Brand" id="brand" required>
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" placeholder="Model" id="model" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" placeholder="Year" id="year" min="1900" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" placeholder="Price" id="price" step="0.01" required>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary">Add Car</button>
            </div>
        </form>
        <div id="addError" class="error mt-2"></div>
    </div>

    <!-- Edit Car Form (Hidden by default) -->
    <div class="form-section edit-form">
        <h3>Edit Car</h3>
        <form id="editCarForm" class="row g-3">
            <input type="hidden" id="editId">
            <div class="col-md-3">
                <input type="text" class="form-control" id="editBrand" required>
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" id="editModel" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" id="editYear" min="1900" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" id="editPrice" step="0.01" required>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-success">Update</button>
                <button type="button" class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
            </div>
        </form>
        <div id="editError" class="error mt-2"></div>
    </div>

    <!-- Car List Table -->
    <h3>Car List</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Brand</th>
                <th>Model</th>
                <th>Year</th>
                <th>Price</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="carTable">
            <!-- Cars will be loaded here -->
        </tbody>
    </table>

    <script>
        // Load cars when page loads
        document.addEventListener('DOMContentLoaded', loadCars);

        // Add Car Form Handler
        document.getElementById('addCarForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const car = {
                brand: document.getElementById('brand').value,
                model: document.getElementById('model').value,
                year: document.getElementById('year').value,
                price: document.getElementById('price').value
            };

            try {
                const response = await fetch('/cars', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(car)
                });

                if (!response.ok) throw new Error(await response.text());
                
                clearForm('addCarForm');
                document.getElementById('addError').textContent = '';
                loadCars();
            } catch (error) {
                document.getElementById('addError').textContent = error.message;
            }
        });

        // Edit Car Form Handler
        document.getElementById('editCarForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const car = {
                brand: document.getElementById('editBrand').value,
                model: document.getElementById('editModel').value,
                year: document.getElementById('editYear').value,
                price: document.getElementById('editPrice').value
            };
            const id = document.getElementById('editId').value;

            try {
                const response = await fetch(`/cars/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(car)
                });

                if (!response.ok) throw new Error(await response.text());

                document.querySelector('.edit-form').style.display = 'none';
                document.getElementById('editError').textContent = '';
                loadCars();
            } catch (error) {
                document.getElementById('editError').textContent = error.message;
            }
        });

        // Load all cars
        async function loadCars() {
            try {
                const response = await fetch('/cars');
                const cars = await response.json();
                renderCars(cars);
            } catch (error) {
                console.error('Error loading cars:', error);
            }
        }

        // Render cars in table
        function renderCars(cars) {
            const tbody = document.getElementById('carTable');
            tbody.innerHTML = '';
            
            cars.forEach(car => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${car.brand}</td>
                    <td>${car.model}</td>
                    <td>${car.year}</td>
                    <td>$${car.price.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editCar(${car.id})">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCar(${car.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Edit car - show form with existing data
        async function editCar(id) {
            try {
                const response = await fetch(`/cars/${id}`);
                const car = await response.json();
                
                document.getElementById('editId').value = car.id;
                document.getElementById('editBrand').value = car.brand;
                document.getElementById('editModel').value = car.model;
                document.getElementById('editYear').value = car.year;
                document.getElementById('editPrice').value = car.price;
                
                document.querySelector('.edit-form').style.display = 'block';
                window.scrollTo(0, 0);
            } catch (error) {
                console.error('Error editing car:', error);
            }
        }

        // Delete car
        async function deleteCar(id) {
            if (confirm('Are you sure you want to delete this car?')) {
                try {
                    const response = await fetch(`/cars/${id}`, { method: 'DELETE' });
                    if (response.ok) loadCars();
                } catch (error) {
                    console.error('Error deleting car:', error);
                }
            }
        }

        // Cancel edit
        function cancelEdit() {
            document.querySelector('.edit-form').style.display = 'none';
            clearForm('editCarForm');
        }

        // Clear form fields
        function clearForm(formId) {
            document.getElementById(formId).reset();
        }
    </script>
</body>
</html>